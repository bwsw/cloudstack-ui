<h3 class="mat-dialog-title">
  {{ title | translate }}
</h3>
<div class="mat-dialog-content">
  <form #rulesForm="ngForm" novalidate>
    <table class="mat-table">
      <thead>
      <tr class="mat-header-row">
        <th class="mat-header-cell">
          {{ 'SECURITY_GROUP_PAGE.RULES.TYPE' | translate }}
        </th>
        <th class="mat-header-cell">
          {{ 'SECURITY_GROUP_PAGE.RULES.PROTOCOL' | translate }}
        </th>
        <ng-template [ngIf]="protocol !== NetworkProtocols.ICMP">
          <th class="mat-header-cell">
            {{ 'SECURITY_GROUP_PAGE.RULES.START_PORT' | translate }}
          </th>
          <th class="mat-header-cell">
            {{ 'SECURITY_GROUP_PAGE.RULES.END_PORT' | translate }}
          </th>
        </ng-template>

        <ng-template [ngIf]="protocol === NetworkProtocols.ICMP">
          <th class="mat-header-cell">
            {{ 'SECURITY_GROUP_PAGE.RULES.ICMP_TYPE' | translate }}
          </th>
          <th class="mat-header-cell">
            {{ 'SECURITY_GROUP_PAGE.RULES.ICMP_CODE' | translate }}
          </th>
        </ng-template>
        <th class="mat-header-cell">
          {{ 'SECURITY_GROUP_PAGE.RULES.CIDR' | translate }}
        </th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <tr class="mat-row table-form" *ngIf="!securityGroup.isPredefinedTemplate">
        <td class="mat-cell">
          <md-select class="type" [(ngModel)]="type" name="type">
            <md-option
              *ngFor="let t of types"
              [value]="t.value"
            >
              {{ t.text | translate }}
            </md-option>
          </md-select>
        </td>
        <td class="mat-cell">
          <md-select [(ngModel)]="protocol" name="protocol">
            <md-option
              *ngFor="let p of protocols"
              [value]="p.value"
            >
              {{ p.text | translate }}
            </md-option>
          </md-select>
        </td>
        <td class="mat-cell">
          <md-form-field *ngIf="protocol === NetworkProtocols.ICMP">
            <input
              mdInput
              name="icmpType"
              type="number"
              [(ngModel)]="icmpType"
              [minValue]="-1"
              integerValue
              [placeholder]="(icmpType === -1 ? 'SECURITY_GROUP_PAGE.RULES.ICMP_ANY' : '') | translate"
              required
              (click)="onIcmpTypeClick()"
              #icmpTypeField="ngModel"
            >
            <md-error *ngIf="icmpTypeField.invalid">
              {{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_TYPE' | translate }}
            </md-error>
          </md-form-field>

          <md-form-field *ngIf="protocol !== NetworkProtocols.ICMP">
            <input
              mdInput
              name="startPort"
              type="number"
              [(ngModel)]="startPort"
              [minValue]="0"
              [maxValue]="65536"
              integerValue
              required
              #startPortField="ngModel"
            >
            <md-error *ngIf="startPortField.invalid">
              {{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_PORT' | translate }}
            </md-error>
          </md-form-field>
        </td>
        <td class="mat-cell">
          <md-form-field *ngIf="protocol === NetworkProtocols.ICMP">
            <input
              mdInput
              name="icmpCode"
              type="number"
              [(ngModel)]="icmpCode"
              [minValue]="-1"
              integerValue
              [placeholder]="(icmpCode === -1 ? 'SECURITY_GROUP_PAGE.RULES.ICMP_ANY' : '') | translate"
              required
              (click)="onIcmpCodeClick()"
              #icmpCodeField="ngModel"
            >
            <md-error *ngIf="icmpCodeField.invalid">
              {{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_CODE' | translate }}
            </md-error>
          </md-form-field>
          <md-form-field *ngIf="protocol !== NetworkProtocols.ICMP">
            <input
              mdInput
              name="endPort"
              type="number"
              [(ngModel)]="endPort"
              [minValue]="0"
              [maxValue]="65536"
              integerValue
              required
              #endPortField="ngModel"
            >
            <md-error *ngIf="endPortField.invalid">
              {{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_PORT' | translate }}
            </md-error>
          </md-form-field>
        </td>
        <td class="cidr mat-cell">
          <md-form-field class="cidr">
            <input
              mdInput
              name="cidr"
              type="text"
              [(ngModel)]="cidr"
              pattern="^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/([0-9]|[1-2][0-9]|3[0-2]))$"
              required
              (click)="onCidrClick()"
              #cidrField="ngModel"
            >
            <md-error *ngIf="cidrField.hasError('pattern')">
              {{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_CIDR' | translate }}
            </md-error>
          </md-form-field>
        </td>
        <td class="mat-cell">
          <button
            md-icon-button
            class="add-rule-button"
            (click)="addRule($event)"
            disabled="{{ securityGroup.isPredefinedTemplate || adding || rulesForm.form.invalid }}"
          >
            <md-icon *ngIf="!adding">add</md-icon>
            <md-spinner *ngIf="adding"></md-spinner>
          </button>
        </td>
      </tr>
      <cs-security-group-rule
        class="mat-row rule-row"
        *ngFor="let rule of securityGroup?.ingressRules"
        [type]="NetworkRuleTypes.Ingress"
        [rule]="rule"
        [canRemove]="!securityGroup.isPredefinedTemplate"
        (onRemove)="removeRule($event)"
      >
      </cs-security-group-rule>
      <cs-security-group-rule
        class="mat-row rule-row"
        *ngFor="let rule of securityGroup?.egressRules"
        [type]="NetworkRuleTypes.Egress"
        [rule]="rule"
        [canRemove]="!securityGroup.isPredefinedTemplate"
        (onRemove)="removeRule($event)"
      >
      </cs-security-group-rule>
      </tbody>
    </table>
  </form>
</div>
<div class="mat-dialog-actions">
  <button md-button color="primary" (click)="onClose()">
    {{ 'COMMON.CLOSE' | translate }}
  </button>
</div>
