<h3 class="mat-dialog-title">
  {{ title | translate }}
</h3>
<div class="mat-dialog-content">
  <form #rulesForm="ngForm" novalidate>
    <table class="mat-table">
      <tbody>
      <tr class="mat-row table-form" *ngIf="!securityGroup.isPredefinedTemplate">
        <td class="mat-cell">
          <md-select class="type" [(ngModel)]="type" name="type">
            <md-option
              *ngFor="let t of types"
              [value]="t.value"
            >
              {{ t.text | translate }}
            </md-option>
          </md-select>
        </td>
        <td class="mat-cell">
          <md-select [(ngModel)]="protocol" name="protocol">
            <md-option
              *ngFor="let p of protocols"
              [value]="p.value"
            >
              {{ p.text | translate }}
            </md-option>
          </md-select>
        </td>
        <td class="cidr mat-cell">
          <mdl-textfield
            [class.is-invalid]="cidrField.touched && cidrField.invalid"
            name="cidr"
            type="text"
            pattern="^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/([0-9]|[1-2][0-9]|3[0-2]))$"
            error-msg="{{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_CIDR' | translate }}"
            required
            [(ngModel)]="cidr"
            #cidrField="ngModel"
            (click)="onCidrClick()"
          >
          </mdl-textfield>
        </td>

        <td class="mat-cell">
          <ng-container *ngIf="protocol === NetworkProtocols.ICMP">
            <md-input-container floatPlaceholder="never">
              <input
                mdInput
                maxValue="255"
                minValue="-1"
                #icmpTypeField="ngModel"
                name="icmpType"
                [placeholder]="'SECURITY_GROUP_PAGE.RULES.ICMP_TYPE' | translate"
                [mdAutocomplete]="icmpTypesAuto"
                [(ngModel)]="selectedType"
                (ngModelChange)="setIcmpTypes(filterTypes(selectedType));"
              >
              <md-error *ngIf="icmpTypeField.invalid">{{
                'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_TYPE' | translate }}
              </md-error>

              <md-autocomplete #icmpTypesAuto="mdAutocomplete">
                <md-option *ngFor="let t of icmpTypes" [value]="t.type">
                  {{ getIcmpTypeTranslationToken(t.type) | translate }} [{{ t.type }}]
                </md-option>
              </md-autocomplete>
            </md-input-container>
          </ng-container>

          <mdl-textfield
            *ngIf="protocol !== NetworkProtocols.ICMP"
            [class.is-invalid]="startPortField.touched && startPortField.invalid"
            name="startPort"
            type="number"
            [placeholder]="'SECURITY_GROUP_PAGE.RULES.START_PORT' | translate"
            minValue="0"
            maxValue="65536"
            integerValue
            error-msg="{{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_PORT' | translate }}"
            required
            [(ngModel)]="startPort"
            #startPortField="ngModel"
          ></mdl-textfield>
        </td>

        <td class="mat-cell">
          <ng-container *ngIf="protocol === NetworkProtocols.ICMP">
            <md-input-container floatPlaceholder="never">
              <input
                mdInput
                name="icmpCode"
                maxValue="255"
                minValue="-1"
                #icmpCodeField="ngModel"
                [placeholder]="'SECURITY_GROUP_PAGE.RULES.ICMP_CODE' | translate"
                [mdAutocomplete]="icmpCodesAuto"
                [(ngModel)]="selectedCode"
                (ngModelChange)="setIcmpCodes(filterCodes(selectedCode))"
              >
              <md-error *ngIf="icmpCodeField.invalid">{{
                'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_CODE' | translate }}
              </md-error>

              <md-autocomplete
                #icmpCodesAuto="mdAutocomplete"
                name="icmpCodesAuto"
              >
                <md-option *ngFor="let t of icmpCodes" [value]="t">
                  {{ getIcmpCodeTranslationToken(icmpType, t) | translate }} [{{ t }}]
                </md-option>
              </md-autocomplete>
            </md-input-container>
          </ng-container>

          <mdl-textfield
            *ngIf="protocol !== NetworkProtocols.ICMP"
            [class.is-invalid]="endPortField.touched && endPortField.invalid"
            name="endPort"
            type="number"
            [placeholder]="'SECURITY_GROUP_PAGE.RULES.END_PORT' | translate"
            minValue="0"
            maxValue="65536"
            integerValue
            error-msg="{{ 'SECURITY_GROUP_PAGE.RULES.ENTER_VALID_PORT' | translate }}"
            required
            [(ngModel)]="endPort"
            #endPortField="ngModel"
          ></mdl-textfield>
        </td>

        <td class="mat-cell">
          <button
            class="add-rule-button"
            mdl-button
            mdl-button-type="icon"
            (click)="addRule($event)"
            disabled="{{ securityGroup.isPredefinedTemplate || adding || rulesForm.form.invalid }}"
          >
            <md-icon *ngIf="!adding">add</md-icon>
            <mdl-spinner single-color active *ngIf="adding"></mdl-spinner>
          </button>
        </td>
      </tr>
      <cs-security-group-rule
        class="mat-row rule-row"
        *ngFor="let rule of securityGroup?.ingressRules"
        [type]="NetworkRuleTypes.Ingress"
        [rule]="rule"
        [canRemove]="!securityGroup.isPredefinedTemplate"
        (onRemove)="removeRule($event)"
      >
      </cs-security-group-rule>
      <cs-security-group-rule
        class="mat-row rule-row"
        *ngFor="let rule of securityGroup?.egressRules"
        [type]="NetworkRuleTypes.Egress"
        [rule]="rule"
        [canRemove]="!securityGroup.isPredefinedTemplate"
        (onRemove)="removeRule($event)"
      >
      </cs-security-group-rule>
      </tbody>
    </table>
  </form>
</div>
<div class="mat-dialog-actions">
  <button
    mdl-button
    mdl-ripple
    mdl-colored="primary"
    (click)="onClose()"
  >{{ 'COMMON.CLOSE' | translate }}</button>
</div>
